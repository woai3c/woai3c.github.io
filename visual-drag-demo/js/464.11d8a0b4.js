"use strict";(self["webpackChunkvisual_drag_demo"]=self["webpackChunkvisual_drag_demo"]||[]).push([[464],{9464:function(t,e,n){n.r(e),n.d(e,{default:function(){return h}});var o=function(){var t=this,e=t._self._c;return"edit"==t.editMode?e("div",{staticClass:"v-text",on:{keydown:t.handleKeydown,keyup:t.handleKeyup}},[e("div",{ref:"text",class:{"can-edit":t.canEdit},style:{verticalAlign:t.element.style.verticalAlign,padding:t.element.style.padding+"px"},attrs:{contenteditable:t.canEdit,tabindex:"0"},domProps:{innerHTML:t._s(t.element.propValue)},on:{dblclick:t.setEdit,paste:t.clearStyle,mousedown:t.handleMousedown,blur:t.handleBlur,input:t.handleInput}})]):e("div",{staticClass:"v-text preview"},[e("div",{style:{verticalAlign:t.element.style.verticalAlign,padding:t.element.style.padding+"px"},domProps:{innerHTML:t._s(t.element.propValue)}})])},i=[],s=n(5353),r=n(8164),a=n(7120),c=n(9254),l=n(9459),u={extends:c.A,props:{propValue:{type:String,required:!0,default:""},request:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}},linkage:{type:Object,default:()=>{}}},data(){return{canEdit:!1,ctrlKey:17,isCtrlDown:!1,cancelRequest:null}},computed:{...(0,s.aH)(["editMode","curComponent"])},created(){this.request&&(this.cancelRequest=(0,a.Ay)(this.request,this.element,"propValue","string")),l.A.$on("componentClick",this.onComponentClick)},beforeDestroy(){this.request&&this.cancelRequest(),l.A.$off("componentClick",this.onComponentClick)},methods:{onComponentClick(){this.curComponent.id!==this.element.id&&(this.canEdit=!1)},handleInput(t){this.$emit("input",this.element,t.target.innerHTML)},handleKeydown(t){this.canEdit&&t.stopPropagation(),t.keyCode==this.ctrlKey?this.isCtrlDown=!0:(this.isCtrlDown&&this.canEdit&&r.W.includes(t.keyCode)||46==t.keyCode)&&t.stopPropagation()},handleKeyup(t){this.canEdit&&t.stopPropagation(),t.keyCode==this.ctrlKey&&(this.isCtrlDown=!1)},handleMousedown(t){this.canEdit&&t.stopPropagation()},clearStyle(t){t.preventDefault();const e=t.clipboardData,n=e.getData("text/plain")||"";""!==n&&document.execCommand("insertText",!1,n),this.$emit("input",this.element,t.target.innerHTML)},handleBlur(t){this.element.propValue=t.target.innerHTML||"&nbsp;";const e=t.target.innerHTML;""!==e?this.element.propValue=t.target.innerHTML:(this.element.propValue="",this.$nextTick((()=>{this.element.propValue="&nbsp;"}))),this.canEdit=!1},setEdit(){this.element.isLock||(this.canEdit=!0,this.selectText(this.$refs.text))},selectText(t){const e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)}}},d=u,p=n(1656),m=(0,p.A)(d,o,i,!1,null,"62f01296",null),h=m.exports},9254:function(t,e,n){n.d(e,{A:function(){return u}});var o,i,s=n(9459),r={props:{linkage:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}}},created(){this.linkage?.data?.length&&(s.A.$on("v-click",this.onClick),s.A.$on("v-hover",this.onHover))},mounted(){const{data:t,duration:e}=this.linkage||{};t?.length&&(this.$el.style.transition=`all ${e}s`)},beforeDestroy(){this.linkage?.data?.length&&(s.A.$off("v-click",this.onClick),s.A.$off("v-hover",this.onHover))},methods:{changeStyle(t=[]){t.forEach((t=>{t.style.forEach((t=>{t.key&&(this.element.style[t.key]=t.value)}))}))},onClick(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-click"===e.event));this.changeStyle(e)},onHover(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-hover"===e.event));this.changeStyle(e)}}},a=r,c=n(1656),l=(0,c.A)(a,o,i,!1,null,null,null),u=l.exports},7120:function(t,e,n){n.d(e,{AP:function(){return c},Ay:function(){return l},ji:function(){return i}});var o=n(1052);const i=/(https?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/;function s(t){return new Promise(((e,n)=>{const o=new XMLHttpRequest;o.timeout=6e3;let i=c(t.url);"GET"===t.method&&(i+=`${r(t.data)}`),o.open(t.method,i),o.ontimeout=n,o.onerror=n,o.onload=t=>{e(t.target.response)},o.send(JSON.stringify(a(t.data,t.paramType)))}))}function r(t){let e="";return t.forEach((t=>{t[0]&&(e+=`&${t[0]}=${t[1]}`)})),e?"?"+e:""}function a(t,e){if(!t)return"";if("array"===e)return t;const n={};return t.forEach((t=>{t[0]&&(n[t[0]]=t[1])})),n}function c(t){return t.startsWith("http")?t:"https://"+t}function l(t,e,n,r="object"){let a,l=0;const u=t?.url;return(u&&!/^\d+$/.test(u)||i.test(c(u)))&&(t.series?a=setInterval((()=>{0!=t.requestCount&&t.requestCount<=l?clearInterval(a):(l++,s(t,r).then((t=>{e[n]="object"===r||"array"===r?JSON.parse(t):t})).catch((t=>o.Message.error(t?.message||t))))}),t.time):s(t,r).then((t=>{e[n]="object"===r||"array"===r?JSON.parse(t):t})).catch((t=>o.Message.error(t?.message||t)))),function(){clearInterval(a)}}},8164:function(t,e,n){n.d(e,{M:function(){return x},W:function(){return C}});var o=n(7666),i=n(9459);const s=17,r=91,a=86,c=67,l=88,u=89,d=90,p=71,m=66,h=76,f=85,y=83,g=80,A=68,k=46,v=69,C=[66,67,68,69,71,76,80,83,85,86,88,89,90],w={[a]:M,[u]:D,[d]:H,[y]:_,[g]:j,[v]:P},b={...w,[f]:I},E={...w,[c]:S,[l]:T,[p]:L,[m]:q,[A]:O,[k]:O,[h]:V};let $=!1;function x(){window.onkeydown=t=>{if(!o.A.state.isInEdiotr)return;const{curComponent:e}=o.A.state,{keyCode:n}=t;n===s||n===r?$=!0:n==k&&e?(o.A.commit("deleteComponent"),o.A.commit("recordSnapshot")):$&&(!E[n]||e&&e.isLock?b[n]&&e&&e.isLock&&(t.preventDefault(),b[n]()):(t.preventDefault(),E[n]()))},window.onkeyup=t=>{t.keyCode!==s&&t.keyCode!==r||($=!1)},window.onmousedown=()=>{o.A.commit("setInEditorStatus",!1)}}function S(){o.A.commit("copy")}function M(){o.A.commit("paste"),o.A.commit("recordSnapshot")}function T(){o.A.commit("cut")}function D(){o.A.commit("redo")}function H(){o.A.commit("undo")}function L(){o.A.state.areaData.components.length&&(o.A.commit("compose"),o.A.commit("recordSnapshot"))}function q(){const t=o.A.state.curComponent;t&&!t.isLock&&"Group"==t.component&&(o.A.commit("decompose"),o.A.commit("recordSnapshot"))}function _(){i.A.$emit("save")}function j(){i.A.$emit("preview")}function O(){o.A.state.curComponent&&(o.A.commit("deleteComponent"),o.A.commit("recordSnapshot"))}function P(){i.A.$emit("clearCanvas")}function V(){o.A.commit("lock")}function I(){o.A.commit("unlock")}}}]);
//# sourceMappingURL=464.11d8a0b4.js.map
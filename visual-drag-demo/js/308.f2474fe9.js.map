{"version":3,"file":"js/308.f2474fe9.js","mappings":"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","sources":["webpack://visual-drag-demo/./src/custom-component/VText/Component.vue","webpack://visual-drag-demo/src/custom-component/VText/Component.vue","webpack://visual-drag-demo/./src/custom-component/VText/Component.vue?1e07","webpack://visual-drag-demo/./src/custom-component/VText/Component.vue?da7c","webpack://visual-drag-demo/./src/custom-component/common/OnEvent.vue","webpack://visual-drag-demo/src/custom-component/common/OnEvent.vue","webpack://visual-drag-demo/./src/custom-component/common/OnEvent.vue?a43b","webpack://visual-drag-demo/./src/utils/request.js","webpack://visual-drag-demo/./src/utils/shortcutKey.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.editMode == 'edit')?_c('div',{staticClass:\"v-text\",on:{\"keydown\":_vm.handleKeydown,\"keyup\":_vm.handleKeyup}},[_c('div',{ref:\"text\",class:{ 'can-edit': _vm.canEdit },style:({ verticalAlign: _vm.element.style.verticalAlign, padding: _vm.element.style.padding + 'px' }),attrs:{\"contenteditable\":_vm.canEdit,\"tabindex\":\"0\"},domProps:{\"innerHTML\":_vm._s(_vm.element.propValue)},on:{\"dblclick\":_vm.setEdit,\"paste\":_vm.clearStyle,\"mousedown\":_vm.handleMousedown,\"blur\":_vm.handleBlur,\"input\":_vm.handleInput}})]):_c('div',{staticClass:\"v-text preview\"},[_c('div',{style:({ verticalAlign: _vm.element.style.verticalAlign, padding: _vm.element.style.padding + 'px' }),domProps:{\"innerHTML\":_vm._s(_vm.element.propValue)}})])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!-- eslint-disable vue/no-v-html -->\n<template>\n  <div v-if=\"editMode == 'edit'\" class=\"v-text\" @keydown=\"handleKeydown\" @keyup=\"handleKeyup\">\n    <!-- tabindex >= 0 使得双击时聚焦该元素 -->\n    <div\n      ref=\"text\"\n      :contenteditable=\"canEdit\"\n      :class=\"{ 'can-edit': canEdit }\"\n      tabindex=\"0\"\n      :style=\"{ verticalAlign: element.style.verticalAlign, padding: element.style.padding + 'px' }\"\n      @dblclick=\"setEdit\"\n      @paste=\"clearStyle\"\n      @mousedown=\"handleMousedown\"\n      @blur=\"handleBlur\"\n      @input=\"handleInput\"\n      v-html=\"element.propValue\"\n    ></div>\n  </div>\n  <div v-else class=\"v-text preview\">\n    <div\n      :style=\"{ verticalAlign: element.style.verticalAlign, padding: element.style.padding + 'px' }\"\n      v-html=\"element.propValue\"\n    ></div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport { keycodes } from '@/utils/shortcutKey.js'\nimport request from '@/utils/request'\nimport OnEvent from '../common/OnEvent'\nimport eventBus from '@/utils/eventBus'\n\nexport default {\n  extends: OnEvent,\n  props: {\n    propValue: {\n      type: String,\n      required: true,\n      default: '',\n    },\n    request: {\n      type: Object,\n      default: () => {},\n    },\n    element: {\n      type: Object,\n      default: () => {},\n    },\n    linkage: {\n      type: Object,\n      default: () => {},\n    },\n  },\n  data() {\n    return {\n      canEdit: false,\n      ctrlKey: 17,\n      isCtrlDown: false,\n      cancelRequest: null,\n    }\n  },\n  computed: {\n    ...mapState(['editMode', 'curComponent']),\n  },\n  created() {\n    // 注意，修改时接口属性时不会发数据，在预览时才会发\n    // 如果要在修改接口属性的同时发请求，需要 watch 一下 request 的属性\n    if (this.request) {\n      // 第二个参数是要修改数据的父对象，第三个参数是修改数据的 key，第四个数据修改数据的类型\n      this.cancelRequest = request(this.request, this.element, 'propValue', 'string')\n    }\n\n    eventBus.$on('componentClick', this.onComponentClick)\n  },\n  beforeDestroy() {\n    // 组件销毁时取消请求\n    this.request && this.cancelRequest()\n    eventBus.$off('componentClick', this.onComponentClick)\n  },\n  methods: {\n    onComponentClick() {\n      // 如果当前点击的组件 id 和 VText 不是同一个，需要设为不允许编辑 https://github.com/woai3c/visual-drag-demo/issues/90\n      if (this.curComponent.id !== this.element.id) {\n        this.canEdit = false\n      }\n    },\n\n    handleInput(e) {\n      this.$emit('input', this.element, e.target.innerHTML)\n    },\n\n    handleKeydown(e) {\n      // 阻止冒泡，防止触发复制、粘贴组件操作\n      this.canEdit && e.stopPropagation()\n      if (e.keyCode == this.ctrlKey) {\n        this.isCtrlDown = true\n      } else if (this.isCtrlDown && this.canEdit && keycodes.includes(e.keyCode)) {\n        e.stopPropagation()\n      } else if (e.keyCode == 46) {\n        // deleteKey\n        e.stopPropagation()\n      }\n    },\n\n    handleKeyup(e) {\n      // 阻止冒泡，防止触发复制、粘贴组件操作\n      this.canEdit && e.stopPropagation()\n      if (e.keyCode == this.ctrlKey) {\n        this.isCtrlDown = false\n      }\n    },\n\n    handleMousedown(e) {\n      if (this.canEdit) {\n        e.stopPropagation()\n      }\n    },\n\n    clearStyle(e) {\n      e.preventDefault()\n      const clp = e.clipboardData\n      const text = clp.getData('text/plain') || ''\n      if (text !== '') {\n        document.execCommand('insertText', false, text)\n      }\n\n      this.$emit('input', this.element, e.target.innerHTML)\n    },\n\n    handleBlur(e) {\n      this.element.propValue = e.target.innerHTML || '&nbsp;'\n      const html = e.target.innerHTML\n      if (html !== '') {\n        this.element.propValue = e.target.innerHTML\n      } else {\n        this.element.propValue = ''\n        this.$nextTick(() => {\n          this.element.propValue = '&nbsp;'\n        })\n      }\n      this.canEdit = false\n    },\n\n    setEdit() {\n      if (this.element.isLock) return\n\n      this.canEdit = true\n      // 全选\n      this.selectText(this.$refs.text)\n    },\n\n    selectText(element) {\n      const selection = window.getSelection()\n      const range = document.createRange()\n      range.selectNodeContents(element)\n      selection.removeAllRanges()\n      selection.addRange(range)\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.v-text {\n  width: 100%;\n  height: 100%;\n  display: table;\n\n  div {\n    display: table-cell;\n    width: 100%;\n    height: 100%;\n    outline: none;\n    word-break: break-all;\n    padding: 4px;\n  }\n\n  .can-edit {\n    cursor: text;\n    height: 100%;\n  }\n}\n\n.preview {\n  user-select: none;\n}\n</style>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Component.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Component.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./Component.vue?vue&type=template&id=7d44aa77&scoped=true\"\nimport script from \"./Component.vue?vue&type=script&lang=js\"\nexport * from \"./Component.vue?vue&type=script&lang=js\"\nimport style0 from \"./Component.vue?vue&type=style&index=0&id=7d44aa77&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7d44aa77\",\n  null\n  \n)\n\nexport default component.exports","var render, staticRenderFns\nimport script from \"./OnEvent.vue?vue&type=script&lang=js\"\nexport * from \"./OnEvent.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<script>\nimport eventBus from '@/utils/eventBus'\n\nexport default {\n  props: {\n    linkage: {\n      type: Object,\n      default: () => {},\n    },\n    element: {\n      type: Object,\n      default: () => {},\n    },\n  },\n  created() {\n    if (this.linkage?.data?.length) {\n      eventBus.$on('v-click', this.onClick)\n      eventBus.$on('v-hover', this.onHover)\n    }\n  },\n  mounted() {\n    const { data, duration } = this.linkage || {}\n    if (data?.length) {\n      this.$el.style.transition = `all ${duration}s`\n    }\n  },\n  beforeDestroy() {\n    if (this.linkage?.data?.length) {\n      eventBus.$off('v-click', this.onClick)\n      eventBus.$off('v-hover', this.onHover)\n    }\n  },\n  methods: {\n    changeStyle(data = []) {\n      data.forEach((item) => {\n        item.style.forEach((e) => {\n          if (e.key) {\n            this.element.style[e.key] = e.value\n          }\n        })\n      })\n    },\n\n    onClick(componentId) {\n      const data = this.linkage.data.filter((item) => item.id === componentId && item.event === 'v-click')\n      this.changeStyle(data)\n    },\n\n    onHover(componentId) {\n      const data = this.linkage.data.filter((item) => item.id === componentId && item.event === 'v-hover')\n      this.changeStyle(data)\n    },\n  },\n}\n</script>\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./OnEvent.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./OnEvent.vue?vue&type=script&lang=js\"","import { Message } from 'element-ui'\n\nexport const urlRE = /(https?):\\/\\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/\n\nfunction request(options) {\n  return new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest()\n    xhr.timeout = 6000\n\n    let url = getURL(options.url)\n    if (options.method === 'GET') {\n      url += `${getURLParam(options.data)}`\n    }\n\n    xhr.open(options.method, url)\n\n    xhr.ontimeout = reject\n    xhr.onerror = reject\n    xhr.onload = (e) => {\n      resolve(e.target.response)\n    }\n\n    xhr.send(JSON.stringify(getURLData(options.data, options.paramType)))\n  })\n}\n\nfunction getURLParam(data) {\n  let result = ''\n  data.forEach((item) => {\n    if (item[0]) {\n      result += `&${item[0]}=${item[1]}`\n    }\n  })\n\n  return result ? `?${result}` : ''\n}\n\nfunction getURLData(data, paramType) {\n  if (!data) return ''\n\n  if (paramType === 'array') {\n    return data\n  }\n\n  const result = {}\n  data.forEach((item) => {\n    if (item[0]) {\n      result[item[0]] = item[1]\n    }\n  })\n\n  return result\n}\n\nexport function getURL(url) {\n  return url.startsWith('http') ? url : `https://${url}`\n}\n\n/**\n *\n * @param {object} options 请求的相关参数\n * @param {object} obj 需要修改的数据的父对象\n * @param {string} key 需要修改的数据在父对象中对应的 key\n * @param {string} responseType 需要修改的数据对应的类型\n * @returns {function} 可以取消请求的函数\n */\nexport default function requestWarpper(options, obj, key, responseType = 'object') {\n  let count = 0\n  let timer\n  const url = options?.url\n  if ((url && !/^\\d+$/.test(url)) || urlRE.test(getURL(url))) {\n    if (!options.series) {\n      request(options, responseType)\n        .then((data) => {\n          if (responseType === 'object' || responseType === 'array') {\n            obj[key] = JSON.parse(data)\n          } else {\n            obj[key] = data\n          }\n        })\n        .catch((err) => Message.error(err?.message || err))\n    } else {\n      timer = setInterval(() => {\n        if (options.requestCount != 0 && options.requestCount <= count) {\n          clearInterval(timer)\n          return\n        }\n\n        count++\n        request(options, responseType)\n          .then((data) => {\n            if (responseType === 'object' || responseType === 'array') {\n              obj[key] = JSON.parse(data)\n            } else {\n              obj[key] = data\n            }\n          })\n          .catch((err) => Message.error(err?.message || err))\n      }, options.time)\n    }\n  }\n\n  return function cancelRequest() {\n    clearInterval(timer)\n  }\n}\n","import store from '@/store'\nimport eventBus from '@/utils/eventBus'\n\nconst ctrlKey = 17,\n  commandKey = 91, // mac command\n  vKey = 86, // 粘贴\n  cKey = 67, // 复制\n  xKey = 88, // 剪切\n  yKey = 89, // 重做\n  zKey = 90, // 撤销\n  gKey = 71, // 组合\n  bKey = 66, // 拆分\n  lKey = 76, // 锁定\n  uKey = 85, // 解锁\n  sKey = 83, // 保存\n  pKey = 80, // 预览\n  dKey = 68, // 删除\n  deleteKey = 46, // 删除\n  eKey = 69 // 清空画布\n\nexport const keycodes = [66, 67, 68, 69, 71, 76, 80, 83, 85, 86, 88, 89, 90]\n\n// 与组件状态无关的操作\nconst basemap = {\n  [vKey]: paste,\n  [yKey]: redo,\n  [zKey]: undo,\n  [sKey]: save,\n  [pKey]: preview,\n  [eKey]: clearCanvas,\n}\n\n// 组件锁定状态下可以执行的操作\nconst lockMap = {\n  ...basemap,\n  [uKey]: unlock,\n}\n\n// 组件未锁定状态下可以执行的操作\nconst unlockMap = {\n  ...basemap,\n  [cKey]: copy,\n  [xKey]: cut,\n  [gKey]: compose,\n  [bKey]: decompose,\n  [dKey]: deleteComponent,\n  [deleteKey]: deleteComponent,\n  [lKey]: lock,\n}\n\nlet isCtrlOrCommandDown = false\n// 全局监听按键操作并执行相应命令\nexport function listenGlobalKeyDown() {\n  window.onkeydown = (e) => {\n    if (!store.state.isInEdiotr) return\n\n    const { curComponent } = store.state\n    const { keyCode } = e\n    if (keyCode === ctrlKey || keyCode === commandKey) {\n      isCtrlOrCommandDown = true\n    } else if (keyCode == deleteKey && curComponent) {\n      store.commit('deleteComponent')\n      store.commit('recordSnapshot')\n    } else if (isCtrlOrCommandDown) {\n      if (unlockMap[keyCode] && (!curComponent || !curComponent.isLock)) {\n        e.preventDefault()\n        unlockMap[keyCode]()\n      } else if (lockMap[keyCode] && curComponent && curComponent.isLock) {\n        e.preventDefault()\n        lockMap[keyCode]()\n      }\n    }\n  }\n\n  window.onkeyup = (e) => {\n    if (e.keyCode === ctrlKey || e.keyCode === commandKey) {\n      isCtrlOrCommandDown = false\n    }\n  }\n\n  window.onmousedown = () => {\n    store.commit('setInEditorStatus', false)\n  }\n}\n\nfunction copy() {\n  store.commit('copy')\n}\n\nfunction paste() {\n  store.commit('paste')\n  store.commit('recordSnapshot')\n}\n\nfunction cut() {\n  store.commit('cut')\n}\n\nfunction redo() {\n  store.commit('redo')\n}\n\nfunction undo() {\n  store.commit('undo')\n}\n\nfunction compose() {\n  if (store.state.areaData.components.length) {\n    store.commit('compose')\n    store.commit('recordSnapshot')\n  }\n}\n\nfunction decompose() {\n  const curComponent = store.state.curComponent\n  if (curComponent && !curComponent.isLock && curComponent.component == 'Group') {\n    store.commit('decompose')\n    store.commit('recordSnapshot')\n  }\n}\n\nfunction save() {\n  eventBus.$emit('save')\n}\n\nfunction preview() {\n  eventBus.$emit('preview')\n}\n\nfunction deleteComponent() {\n  if (store.state.curComponent) {\n    store.commit('deleteComponent')\n    store.commit('recordSnapshot')\n  }\n}\n\nfunction clearCanvas() {\n  eventBus.$emit('clearCanvas')\n}\n\nfunction lock() {\n  store.commit('lock')\n}\n\nfunction unlock() {\n  store.commit('unlock')\n}\n"],"names":["render","_vm","this","_c","_self","editMode","staticClass","on","handleKeydown","handleKeyup","ref","class","canEdit","style","verticalAlign","element","padding","attrs","domProps","_s","propValue","setEdit","clearStyle","handleMousedown","handleBlur","handleInput","staticRenderFns","extends","OnEvent","props","type","String","required","default","request","Object","linkage","data","ctrlKey","isCtrlDown","cancelRequest","computed","mapState","created","eventBus","$on","onComponentClick","beforeDestroy","$off","methods","curComponent","id","e","$emit","target","innerHTML","stopPropagation","keyCode","keycodes","includes","preventDefault","clp","clipboardData","text","getData","document","execCommand","html","$nextTick","isLock","selectText","$refs","selection","window","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","component","length","onClick","onHover","mounted","duration","$el","transition","changeStyle","forEach","item","key","value","componentId","filter","event","urlRE","options","Promise","resolve","reject","xhr","XMLHttpRequest","timeout","url","getURL","method","getURLParam","open","ontimeout","onerror","onload","response","send","JSON","stringify","getURLData","paramType","result","startsWith","requestWarpper","obj","responseType","timer","count","test","series","setInterval","requestCount","clearInterval","then","parse","catch","err","Message","error","message","time","commandKey","vKey","cKey","xKey","yKey","zKey","gKey","bKey","lKey","uKey","sKey","pKey","dKey","deleteKey","eKey","basemap","paste","redo","undo","save","preview","clearCanvas","lockMap","unlock","unlockMap","copy","cut","compose","decompose","deleteComponent","lock","isCtrlOrCommandDown","listenGlobalKeyDown","onkeydown","store","state","isInEdiotr","commit","onkeyup","onmousedown","areaData","components"],"sourceRoot":""}